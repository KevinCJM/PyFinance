# -*- encoding: utf-8 -*-
"""
@File: A03_ideal_portfolio_api.py
@Modify Time: 2025/9/17 08:05       
@Author: Kevin-Chen
@Descriptions: 根据已有持仓寻找组合配置:  风险不变收益最大,收益不变风险最小,持仓组合变动最小
"""
import json
import numpy as np
import pandas as pd
from scipy.optimize import minimize

from T04_show_plt import plot_efficient_frontier
from T02_other_tools import load_returns_from_excel
from T01_generate_random_weights import compute_perf_arrays, compute_var_parametric_arrays
from T03_weight_limit_cal import level_weight_limit_cal
from T01_generate_random_weights import generate_weights_random_walk


def analysis_json_and_read_data(json_input, excel_name, sheet_name):
    # json转字典
    params = json.loads(json_input)
    asset_list = params['asset_list']
    draw_plt = params.get('draw_plt', True)
    draw_plt_filename = params.get('draw_plt_filename', None)
    user_holding = params['user_holding']
    ef_data = params['ef_data']
    # 读取excel，生成日收益二维数组
    returns, assets = load_returns_from_excel(excel_name, sheet_name, asset_list)
    return asset_list, draw_plt, draw_plt_filename, user_holding, ef_data, returns


if __name__ == '__main__':
    ''' 准备工作: 模拟json参数输入 ------------------------------------------------------------------------------ '''
    # 字典格式入参
    dict_input = {
        'asset_list': [
            '货币现金类', '固定收益类', '混合策略类', '权益投资类', '另类投资类'
        ],
        'draw_plt': True,  # 是否绘图展示
        'draw_plt_filename': None,  # 绘图保存文件名，None表示不保存直接显示
        'user_holding': {
            'WeightRange': {  # 用户所属的风险等级对应的各资产权重上下限
                '货币现金类': [0.0, 1.0], '固定收益类': [0.0, 1.0], '混合策略类': [0.0, 0.4],
                '权益投资类': [0.0, 0.7], '另类投资类': [0.0, 0.12]
            },
            'StandardProportion': {  # 用户当前持仓
                '货币现金类': 0.1, '固定收益类': 0.2, '混合策略类': 0.2, '权益投资类': 0.4, '另类投资类': 0.1
            },
            'can_sell': {  # 能否卖出
                '货币现金类': False,
                '固定收益类': True,
                '混合策略类': False,
                '权益投资类': True,
                '另类投资类': True
            },
            'can_buy': {  # 能否买入
                '货币现金类': True,
                '固定收益类': True,
                '混合策略类': False,
                '权益投资类': True,
                '另类投资类': True
            }
        },
        'ef_data': {  # 有效前沿数据 (权重,收益指标,风险指标)
            "weights": [
                [
                    0.832,
                    0.15,
                    0.015,
                    0.0,
                    0.003
                ],
                [
                    0.583,
                    0.374,
                    0.036,
                    0.0,
                    0.007
                ],
                [
                    0.5,
                    0.449,
                    0.039,
                    0.0,
                    0.012
                ],
                [
                    0.416,
                    0.522,
                    0.05,
                    0.0,
                    0.012
                ],
                [
                    0.333,
                    0.596,
                    0.055,
                    0.0,
                    0.016
                ],
                [
                    0.25,
                    0.673,
                    0.059,
                    0.0,
                    0.018
                ],
                [
                    0.165,
                    0.745,
                    0.067,
                    0.0,
                    0.023
                ],
                [
                    0.085,
                    0.819,
                    0.074,
                    0.0,
                    0.022
                ],
                [
                    0.002,
                    0.895,
                    0.079,
                    0.0,
                    0.024
                ],
                [
                    0.0,
                    0.84,
                    0.119,
                    0.0,
                    0.041
                ],
                [
                    0.0,
                    0.795,
                    0.15,
                    0.0,
                    0.055
                ],
                [
                    0.0,
                    0.758,
                    0.178,
                    0.0,
                    0.064
                ],
                [
                    0.0,
                    0.725,
                    0.201,
                    0.0,
                    0.074
                ],
                [
                    0.0,
                    0.693,
                    0.223,
                    0.0,
                    0.084
                ],
                [
                    0.0,
                    0.662,
                    0.245,
                    0.0,
                    0.093
                ],
                [
                    0.0,
                    0.632,
                    0.266,
                    0.0,
                    0.102
                ],
                [
                    0.0,
                    0.604,
                    0.286,
                    0.0,
                    0.11
                ],
                [
                    0.0,
                    0.575,
                    0.307,
                    0.0,
                    0.118
                ],
                [
                    0.0,
                    0.549,
                    0.325,
                    0.0,
                    0.126
                ],
                [
                    0.0,
                    0.523,
                    0.344,
                    0.0,
                    0.133
                ],
                [
                    0.0,
                    0.496,
                    0.363,
                    0.0,
                    0.141
                ],
                [
                    0.0,
                    0.471,
                    0.38,
                    0.0,
                    0.149
                ],
                [
                    0.0,
                    0.445,
                    0.398,
                    0.0,
                    0.157
                ],
                [
                    0.0,
                    0.421,
                    0.416,
                    0.0,
                    0.163
                ],
                [
                    0.0,
                    0.395,
                    0.434,
                    0.0,
                    0.171
                ],
                [
                    0.0,
                    0.37,
                    0.451,
                    0.0,
                    0.179
                ],
                [
                    0.0,
                    0.346,
                    0.469,
                    0.0,
                    0.185
                ],
                [
                    0.0,
                    0.32,
                    0.486,
                    0.0,
                    0.194
                ],
                [
                    0.0,
                    0.296,
                    0.504,
                    0.0,
                    0.2
                ],
                [
                    0.0,
                    0.272,
                    0.521,
                    0.0,
                    0.207
                ],
                [
                    0.0,
                    0.249,
                    0.537,
                    0.0,
                    0.214
                ],
                [
                    0.0,
                    0.223,
                    0.556,
                    0.0,
                    0.221
                ],
                [
                    0.0,
                    0.199,
                    0.573,
                    0.0,
                    0.228
                ],
                [
                    0.0,
                    0.177,
                    0.589,
                    0.0,
                    0.234
                ],
                [
                    0.0,
                    0.152,
                    0.606,
                    0.0,
                    0.242
                ],
                [
                    0.0,
                    0.128,
                    0.623,
                    0.0,
                    0.249
                ],
                [
                    0.0,
                    0.105,
                    0.639,
                    0.0,
                    0.256
                ],
                [
                    0.0,
                    0.08,
                    0.657,
                    0.0,
                    0.263
                ],
                [
                    0.0,
                    0.057,
                    0.673,
                    0.0,
                    0.27
                ],
                [
                    0.0,
                    0.034,
                    0.689,
                    0.0,
                    0.277
                ],
                [
                    0.0,
                    0.014,
                    0.699,
                    0.001,
                    0.286
                ],
                [
                    0.0,
                    0.0,
                    0.704,
                    0.004,
                    0.292
                ],
                [
                    0.0,
                    0.0,
                    0.688,
                    0.01,
                    0.302
                ],
                [
                    0.0,
                    0.0,
                    0.672,
                    0.016,
                    0.312
                ],
                [
                    0.0,
                    0.0,
                    0.655,
                    0.022,
                    0.323
                ],
                [
                    0.0,
                    0.0,
                    0.641,
                    0.028,
                    0.331
                ],
                [
                    0.0,
                    0.0,
                    0.624,
                    0.034,
                    0.342
                ],
                [
                    0.0,
                    0.0,
                    0.609,
                    0.04,
                    0.351
                ],
                [
                    0.0,
                    0.0,
                    0.593,
                    0.046,
                    0.361
                ],
                [
                    0.0,
                    0.0,
                    0.577,
                    0.052,
                    0.371
                ],
                [
                    0.0,
                    0.0,
                    0.56,
                    0.059,
                    0.381
                ],
                [
                    0.0,
                    0.0,
                    0.546,
                    0.063,
                    0.391
                ],
                [
                    0.0,
                    0.0,
                    0.531,
                    0.07,
                    0.399
                ],
                [
                    0.0,
                    0.0,
                    0.514,
                    0.075,
                    0.411
                ],
                [
                    0.0,
                    0.0,
                    0.501,
                    0.081,
                    0.418
                ],
                [
                    0.0,
                    0.0,
                    0.485,
                    0.089,
                    0.426
                ],
                [
                    0.0,
                    0.0,
                    0.47,
                    0.093,
                    0.437
                ],
                [
                    0.0,
                    0.0,
                    0.455,
                    0.098,
                    0.447
                ],
                [
                    0.0,
                    0.0,
                    0.44,
                    0.104,
                    0.456
                ],
                [
                    0.0,
                    0.0,
                    0.425,
                    0.11,
                    0.465
                ],
                [
                    0.0,
                    0.0,
                    0.411,
                    0.115,
                    0.474
                ],
                [
                    0.0,
                    0.0,
                    0.395,
                    0.121,
                    0.484
                ],
                [
                    0.0,
                    0.0,
                    0.381,
                    0.126,
                    0.493
                ],
                [
                    0.0,
                    0.0,
                    0.365,
                    0.134,
                    0.501
                ],
                [
                    0.0,
                    0.0,
                    0.349,
                    0.141,
                    0.51
                ],
                [
                    0.0,
                    0.0,
                    0.337,
                    0.143,
                    0.52
                ],
                [
                    0.0,
                    0.0,
                    0.321,
                    0.149,
                    0.53
                ],
                [
                    0.0,
                    0.0,
                    0.305,
                    0.155,
                    0.54
                ],
                [
                    0.0,
                    0.0,
                    0.292,
                    0.16,
                    0.548
                ],
                [
                    0.0,
                    0.0,
                    0.279,
                    0.165,
                    0.556
                ],
                [
                    0.749,
                    0.224,
                    0.02,
                    0.0,
                    0.007
                ],
                [
                    0.0,
                    0.0,
                    0.248,
                    0.178,
                    0.574
                ],
                [
                    0.0,
                    0.0,
                    0.236,
                    0.181,
                    0.583
                ],
                [
                    0.0,
                    0.0,
                    0.218,
                    0.188,
                    0.594
                ],
                [
                    0.0,
                    0.0,
                    0.206,
                    0.193,
                    0.601
                ],
                [
                    0.0,
                    0.0,
                    0.189,
                    0.199,
                    0.612
                ],
                [
                    0.0,
                    0.0,
                    0.174,
                    0.206,
                    0.62
                ],
                [
                    0.0,
                    0.0,
                    0.16,
                    0.21,
                    0.63
                ],
                [
                    0.0,
                    0.0,
                    0.146,
                    0.215,
                    0.639
                ],
                [
                    0.0,
                    0.0,
                    0.131,
                    0.221,
                    0.648
                ],
                [
                    0.0,
                    0.0,
                    0.118,
                    0.225,
                    0.657
                ],
                [
                    0.0,
                    0.0,
                    0.102,
                    0.232,
                    0.666
                ],
                [
                    0.666,
                    0.299,
                    0.027,
                    0.0,
                    0.008
                ],
                [
                    0.0,
                    0.0,
                    0.073,
                    0.244,
                    0.683
                ],
                [
                    0.0,
                    0.0,
                    0.061,
                    0.25,
                    0.689
                ],
                [
                    0.0,
                    0.0,
                    0.045,
                    0.256,
                    0.699
                ],
                [
                    1.0,
                    0.0,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.015,
                    0.266,
                    0.719
                ],
                [
                    0.0,
                    0.0,
                    0.001,
                    0.27,
                    0.729
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.331,
                    0.669
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.365,
                    0.635
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.392,
                    0.608
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.414,
                    0.586
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.434,
                    0.566
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.453,
                    0.547
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.47,
                    0.53
                ],
                [
                    0.0,
                    0.0,
                    0.03,
                    0.259,
                    0.711
                ],
                [
                    0.915,
                    0.076,
                    0.007,
                    0.0,
                    0.002
                ],
                [
                    0.0,
                    0.0,
                    0.086,
                    0.237,
                    0.677
                ],
                [
                    0.0,
                    0.0,
                    0.263,
                    0.172,
                    0.565
                ],
                [
                    0.0,
                    0.259,
                    0.5,
                    0.0,
                    0.241
                ],
                [
                    0.0,
                    0.0,
                    0.493,
                    0.054,
                    0.453
                ],
                [
                    0.0,
                    0.0,
                    0.063,
                    0.275,
                    0.662
                ],
                [
                    0.0,
                    0.721,
                    0.228,
                    0.0,
                    0.051
                ],
                [
                    0.0,
                    0.938,
                    0.044,
                    0.0,
                    0.018
                ],
                [
                    0.005,
                    0.178,
                    0.569,
                    0.005,
                    0.243
                ],
                [
                    0.0,
                    0.639,
                    0.196,
                    0.0,
                    0.165
                ],
                [
                    0.0,
                    0.015,
                    0.549,
                    0.038,
                    0.398
                ],
                [
                    0.0,
                    0.0,
                    0.518,
                    0.05,
                    0.432
                ],
                [
                    0.0,
                    0.007,
                    0.135,
                    0.26,
                    0.598
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.415,
                    0.585
                ],
                [
                    0.0,
                    0.0,
                    0.067,
                    0.258,
                    0.675
                ],
                [
                    0.0,
                    0.079,
                    0.614,
                    0.0,
                    0.307
                ],
                [
                    0.004,
                    0.01,
                    0.703,
                    0.017,
                    0.266
                ],
                [
                    0.0,
                    0.036,
                    0.623,
                    0.024,
                    0.317
                ],
                [
                    0.0,
                    0.069,
                    0.627,
                    0.0,
                    0.304
                ],
                [
                    0.988,
                    0.0,
                    0.012,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.801,
                    0.199,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.826,
                    0.174,
                    0.0,
                    0.0
                ],
                [
                    0.063,
                    0.782,
                    0.114,
                    0.0,
                    0.041
                ],
                [
                    0.17,
                    0.741,
                    0.089,
                    0.0,
                    0.0
                ],
                [
                    0.004,
                    0.0,
                    0.02,
                    0.294,
                    0.682
                ],
                [
                    0.343,
                    0.636,
                    0.021,
                    0.0,
                    0.0
                ],
                [
                    0.088,
                    0.887,
                    0.0,
                    0.0,
                    0.025
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.395,
                    0.605
                ],
                [
                    0.0,
                    0.0,
                    0.141,
                    0.263,
                    0.596
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.44,
                    0.56
                ],
                [
                    0.0,
                    0.094,
                    0.467,
                    0.051,
                    0.388
                ],
                [
                    0.0,
                    0.0,
                    0.052,
                    0.236,
                    0.712
                ],
                [
                    0.0,
                    0.0,
                    0.162,
                    0.179,
                    0.659
                ],
                [
                    0.0,
                    0.446,
                    0.303,
                    0.037,
                    0.214
                ],
                [
                    0.0,
                    0.397,
                    0.358,
                    0.0,
                    0.245
                ],
                [
                    0.0,
                    0.523,
                    0.3,
                    0.0,
                    0.177
                ],
                [
                    0.31,
                    0.579,
                    0.111,
                    0.0,
                    0.0
                ],
                [
                    0.597,
                    0.403,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.698,
                    0.302,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.002,
                    0.589,
                    0.243,
                    0.002,
                    0.164
                ],
                [
                    0.0,
                    0.0,
                    0.59,
                    0.024,
                    0.386
                ],
                [
                    0.0,
                    0.096,
                    0.667,
                    0.0,
                    0.237
                ],
                [
                    0.0,
                    0.517,
                    0.428,
                    0.0,
                    0.055
                ],
                [
                    0.0,
                    0.351,
                    0.447,
                    0.0,
                    0.202
                ],
                [
                    0.0,
                    0.425,
                    0.382,
                    0.0,
                    0.193
                ],
                [
                    0.0,
                    0.786,
                    0.18,
                    0.0,
                    0.034
                ],
                [
                    0.0,
                    0.656,
                    0.185,
                    0.026,
                    0.133
                ],
                [
                    0.0,
                    0.0,
                    0.074,
                    0.215,
                    0.711
                ],
                [
                    0.0,
                    0.383,
                    0.474,
                    0.0,
                    0.143
                ],
                [
                    0.017,
                    0.439,
                    0.354,
                    0.026,
                    0.164
                ],
                [
                    0.0,
                    0.0,
                    0.557,
                    0.045,
                    0.398
                ],
                [
                    0.0,
                    0.027,
                    0.0,
                    0.25,
                    0.723
                ],
                [
                    0.0,
                    0.411,
                    0.337,
                    0.038,
                    0.214
                ],
                [
                    0.0,
                    0.827,
                    0.136,
                    0.0,
                    0.037
                ],
                [
                    0.0,
                    0.805,
                    0.186,
                    0.0,
                    0.009
                ],
                [
                    0.0,
                    0.064,
                    0.686,
                    0.0,
                    0.25
                ],
                [
                    0.0,
                    0.817,
                    0.182,
                    0.0,
                    0.001
                ],
                [
                    0.934,
                    0.066,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.52,
                    0.098,
                    0.382
                ],
                [
                    0.0,
                    0.031,
                    0.0,
                    0.279,
                    0.69
                ],
                [
                    0.785,
                    0.215,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.5,
                    0.5,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.874,
                    0.126,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.92,
                    0.08,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.034,
                    0.664,
                    0.0,
                    0.302
                ],
                [
                    0.0,
                    0.0,
                    0.695,
                    0.0,
                    0.305
                ],
                [
                    0.0,
                    0.378,
                    0.378,
                    0.0,
                    0.244
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.313,
                    0.687
                ],
                [
                    0.0,
                    0.0,
                    0.224,
                    0.157,
                    0.619
                ],
                [
                    0.61,
                    0.39,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.402,
                    0.398,
                    0.0,
                    0.2
                ],
                [
                    0.313,
                    0.54,
                    0.147,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.13,
                    0.6,
                    0.0,
                    0.27
                ],
                [
                    0.227,
                    0.773,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.425,
                    0.15,
                    0.425
                ],
                [
                    0.672,
                    0.328,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.154,
                    0.755,
                    0.091,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.509,
                    0.398,
                    0.0,
                    0.093
                ],
                [
                    0.973,
                    0.024,
                    0.0,
                    0.0,
                    0.003
                ],
                [
                    0.877,
                    0.123,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.08,
                    0.754,
                    0.166,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.393,
                    0.393,
                    0.0,
                    0.214
                ],
                [
                    0.0,
                    0.0,
                    0.051,
                    0.272,
                    0.677
                ],
                [
                    0.744,
                    0.256,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.69,
                    0.31,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.309,
                    0.137,
                    0.554
                ],
                [
                    0.0,
                    0.0,
                    0.452,
                    0.134,
                    0.414
                ],
                [
                    0.0,
                    0.612,
                    0.323,
                    0.0,
                    0.065
                ],
                [
                    0.0,
                    0.0,
                    0.73,
                    0.0,
                    0.27
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.339,
                    0.661
                ],
                [
                    0.684,
                    0.316,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.756,
                    0.0,
                    0.244
                ],
                [
                    0.0,
                    0.291,
                    0.386,
                    0.018,
                    0.305
                ],
                [
                    0.0,
                    0.0,
                    0.359,
                    0.171,
                    0.47
                ],
                [
                    0.0,
                    0.0,
                    0.666,
                    0.0,
                    0.334
                ],
                [
                    0.389,
                    0.611,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.688,
                    0.0,
                    0.312
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.324,
                    0.676
                ],
                [
                    0.0,
                    0.074,
                    0.543,
                    0.046,
                    0.337
                ],
                [
                    0.0,
                    0.078,
                    0.601,
                    0.0,
                    0.321
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.35,
                    0.65
                ],
                [
                    0.656,
                    0.344,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.703,
                    0.211,
                    0.0,
                    0.086
                ],
                [
                    0.0,
                    0.0,
                    0.681,
                    0.0,
                    0.319
                ],
                [
                    0.0,
                    0.068,
                    0.0,
                    0.228,
                    0.704
                ],
                [
                    0.512,
                    0.488,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.391,
                    0.495,
                    0.114,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.368,
                    0.368,
                    0.053,
                    0.211
                ],
                [
                    0.395,
                    0.605,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.0,
                    0.456,
                    0.544
                ],
                [
                    0.409,
                    0.591,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.652,
                    0.27,
                    0.078,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.736,
                    0.0,
                    0.264
                ],
                [
                    0.774,
                    0.226,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.724,
                    0.144,
                    0.0,
                    0.132
                ],
                [
                    0.206,
                    0.762,
                    0.0,
                    0.0,
                    0.032
                ],
                [
                    0.0,
                    0.913,
                    0.087,
                    0.0,
                    0.0
                ],
                [
                    0.615,
                    0.385,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.374,
                    0.6,
                    0.0,
                    0.0,
                    0.026
                ],
                [
                    0.582,
                    0.344,
                    0.074,
                    0.0,
                    0.0
                ],
                [
                    0.948,
                    0.052,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.961,
                    0.039,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.425,
                    0.575,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.0,
                    0.766,
                    0.0,
                    0.234
                ],
                [
                    0.0,
                    0.492,
                    0.422,
                    0.0,
                    0.086
                ],
                [
                    0.486,
                    0.514,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.429,
                    0.571,
                    0.0,
                    0.0,
                    0.0
                ],
                [
                    0.0,
                    0.716,
                    0.203,
                    0.0,
                    0.081
                ],
                [
                    0.0,
                    0.0,
                    0.601,
                    0.0,
                    0.399
                ]
            ],
            "ret_annual": [
                0.014710287563502789,
                0.021147744730114937,
                0.023436402902007103,
                0.025595374405384064,
                0.027858903631567955,
                0.029987331479787827,
                0.032406747341156006,
                0.03434094786643982,
                0.03648454323410988,
                0.03821839392185211,
                0.03957091271877289,
                0.04057888686656952,
                0.04155663400888443,
                0.04251561686396599,
                0.043415579944849014,
                0.04429697245359421,
                0.04510246962308884,
                0.045924071222543716,
                0.04669312387704849,
                0.047421157360076904,
                0.048205576837062836,
                0.048954807221889496,
                0.04972023889422417,
                0.05037069693207741,
                0.05113450810313225,
                0.051880259066820145,
                0.05252851918339729,
                0.0533294752240181,
                0.05397620424628258,
                0.05466199293732643,
                0.055330123752355576,
                0.05604838207364082,
                0.05673185735940933,
                0.05734129995107651,
                0.05807986855506897,
                0.058761149644851685,
                0.05942491069436073,
                0.060121554881334305,
                0.06078389659523964,
                0.0614454485476017,
                0.06217741221189499,
                0.06277638673782349,
                0.06342576444149017,
                0.0640740767121315,
                0.06476067006587982,
                0.06532926112413406,
                0.06601399183273315,
                0.0666201040148735,
                0.06726425141096115,
                0.06790746003389359,
                0.06859223544597626,
                0.06914886087179184,
                0.06975466758012772,
                0.07042936980724335,
                0.07095277309417725,
                0.0715983435511589,
                0.07219003885984421,
                0.07278449833393097,
                0.07338204234838486,
                0.07397874444723129,
                0.07453282922506332,
                0.07516612112522125,
                0.07571861892938614,
                0.07635773718357086,
                0.07699218392372131,
                0.07745589315891266,
                0.0780852660536766,
                0.0787138119339943,
                0.0792241171002388,
                0.07973416149616241,
                0.016977831721305847,
                0.08095169812440872,
                0.08141481876373291,
                0.08211752027273178,
                0.08258672058582306,
                0.08324643224477768,
                0.08383392542600632,
                0.08437254279851913,
                0.08491402119398117,
                0.08549574017524719,
                0.08599507063627243,
                0.08661610633134842,
                0.01910412684082985,
                0.08773717284202576,
                0.08820395171642303,
                0.08881832659244537,
                0.010331140831112862,
                0.0899636372923851,
                0.09049483388662338,
                0.09071378409862518,
                0.09078696370124817,
                0.09083034843206406,
                0.09085612744092941,
                0.09087224304676056,
                0.09088097512722015,
                0.09088337421417236,
                0.08938434720039368,
                0.012564944103360176,
                0.08722925186157227,
                0.08036397397518158,
                0.05622989684343338,
                0.07115425914525986,
                0.08821093291044235,
                0.040692009031772614,
                0.035569921135902405,
                0.05769520252943039,
                0.04670832306146622,
                0.06810646504163742,
                0.07017814368009567,
                0.08509362488985062,
                0.09085708856582642,
                0.08800803869962692,
                0.06186565011739731,
                0.0619843453168869,
                0.06400959938764572,
                0.06191638857126236,
                0.01082275528460741,
                0.037221699953079224,
                0.03678686171770096,
                0.036659106612205505,
                0.03133102506399155,
                0.08956249803304672,
                0.026094824075698853,
                0.03315204754471779,
                0.09083431214094162,
                0.08525318652391434,
                0.09087570011615753,
                0.0669548436999321,
                0.08848631381988525,
                0.08417904376983643,
                0.05358785390853882,
                0.054040759801864624,
                0.049183547496795654,
                0.028440363705158234,
                0.01977982558310032,
                0.017413266003131866,
                0.04753655567765236,
                0.06729485094547272,
                0.05882643163204193,
                0.04437278211116791,
                0.05312012881040573,
                0.051499638706445694,
                0.0388721227645874,
                0.04627479240298271,
                0.0875907763838768,
                0.05021853744983673,
                0.050548918545246124,
                0.06865495443344116,
                0.08902426064014435,
                0.05422665923833847,
                0.03828167915344238,
                0.03752070665359497,
                0.059878334403038025,
                0.03698443993926048,
                0.011879459954798222,
                0.07027706503868103,
                0.08891234546899796,
                0.015373901464045048,
                0.022051721811294556,
                0.013286898843944073,
                0.035147566348314285,
                0.06242603808641434,
                0.06311382353305817,
                0.05432528257369995,
                0.09066672623157501,
                0.08177350461483002,
                0.019475262612104416,
                0.052171047776937485,
                0.02899789810180664,
                0.05955499783158302,
                0.02844068594276905,
                0.07411020994186401,
                0.018022572621703148,
                0.031740058213472366,
                0.046049702912569046,
                0.0111400680616498,
                0.01321652065962553,
                0.034777846187353134,
                0.05288108438253403,
                0.08864858746528625,
                0.016335057094693184,
                0.01760077103972435,
                0.07849474251270294,
                0.0730208083987236,
                0.0431443452835083,
                0.06174071878194809,
                0.09073285758495331,
                0.017741385847330093,
                0.0607161819934845,
                0.0589873380959034,
                0.07670862227678299,
                0.06424617022275925,
                0.024650314822793007,
                0.06338755041360855,
                0.09069624543190002,
                0.06509464979171753,
                0.0624297633767128,
                0.09075719863176346,
                0.018397487699985504,
                0.04242357984185219,
                0.063661128282547,
                0.0867554321885109,
                0.021770715713500977,
                0.02659717947244644,
                0.05548492819070816,
                0.024509888142347336,
                0.09088177978992462,
                0.024182207882404327,
                0.019856249913573265,
                0.06150459498167038,
                0.015631794929504395,
                0.04391592741012573,
                0.03080153279006481,
                0.03526986017823219,
                0.019358154386281967,
                0.026521138846874237,
                0.021426348015666008,
                0.011551005765795708,
                0.01124600414186716,
                0.02380763366818428,
                0.0603211373090744,
                0.04605844244360924,
                0.02237953059375286,
                0.023714013397693634,
                0.041996195912361145,
                0.06676702201366425
            ],
            "risk_arr": [
                0.00012290918675716966,
                0.0003642962547019124,
                0.0004493316519074142,
                0.000530487101059407,
                0.0006150901317596436,
                0.0006949094240553677,
                0.0007858958560973406,
                0.0008582831942476332,
                0.0009387831087224185,
                0.0010205655125901103,
                0.0011070040054619312,
                0.001181839732453227,
                0.0012614346342161298,
                0.001345154014416039,
                0.001428017858415842,
                0.0015126217622309923,
                0.0015925017651170492,
                0.00167619320563972,
                0.0017562926514074206,
                0.001833513961173594,
                0.001918078982271254,
                0.0020000224467366934,
                0.002084816340357065,
                0.0021576345898211002,
                0.0022439700551331043,
                0.0023290624376386404,
                0.002403596881777048,
                0.002496388042345643,
                0.0025718153920024633,
                0.0026522697880864143,
                0.0027310759760439396,
                0.0028162412345409393,
                0.0028976958710700274,
                0.0029706384520977736,
                0.0030593895353376865,
                0.0031416178680956364,
                0.0032220252323895693,
                0.003306729020550847,
                0.0033875226508826017,
                0.0034684923011809587,
                0.0035583865828812122,
                0.0036321100778877735,
                0.003712662262842059,
                0.0037937993183732033,
                0.0038804456125944853,
                0.003952728118747473,
                0.004040409345179796,
                0.004118537064641714,
                0.0042021144181489944,
                0.004286095965653658,
                0.004376064985990524,
                0.004449623636901379,
                0.004530023783445358,
                0.004620097111910582,
                0.004690253175795078,
                0.004777275957167149,
                0.004857249557971954,
                0.004938025493174791,
                0.005019525997340679,
                0.005101250018924475,
                0.005177411250770092,
                0.005264809355139732,
                0.005341341719031334,
                0.005430177319794893,
                0.005518739111721516,
                0.005583498626947403,
                0.0056718215346336365,
                0.005760315805673599,
                0.005832407157868147,
                0.005904605612158775,
                0.00020759871404152364,
                0.00607775105163455,
                0.006143857259303331,
                0.006244469899684191,
                0.006311812438070774,
                0.00640677846968174,
                0.006491584703326225,
                0.006569499149918556,
                0.00664803571999073,
                0.006732598412781954,
                0.006805367302149534,
                0.006896058563143015,
                0.00028709362959489226,
                0.007060379721224308,
                0.007129059173166752,
                0.007219593971967697,
                0.0,
                0.0073888832703232765,
                0.007467655465006828,
                0.007548705209046602,
                0.007629104424268007,
                0.007711851969361305,
                0.0077912695705890656,
                0.007872537709772587,
                0.007957510650157928,
                0.00803975947201252,
                0.007303125225007534,
                4.2492971260799095e-05,
                0.00698584970086813,
                0.005994048900902271,
                0.002843037713319063,
                0.004735402762889862,
                0.007141084410250187,
                0.0011985383462160826,
                0.000911898969206959,
                0.0030269864946603775,
                0.0017957203090190887,
                0.0043245055712759495,
                0.0045988475903868675,
                0.006704634055495262,
                0.00779512757435441,
                0.00710241449996829,
                0.003528921166434884,
                0.0035525241401046515,
                0.0037887138314545155,
                0.0035328816156834364,
                0.0,
                0.0010106374975293875,
                0.0009818184189498425,
                0.0009649661369621754,
                0.0007592305773869157,
                0.007359074428677559,
                0.0005729967961087823,
                0.0008325761300511658,
                0.007722055539488792,
                0.006728030275553465,
                0.007898563519120216,
                0.004188769031316042,
                0.007173736114054918,
                0.006555420812219381,
                0.002556628780439496,
                0.00261411489918828,
                0.0020399759523570538,
                0.0006551862461492419,
                0.0003356559027452022,
                0.00024124080664478242,
                0.0018714233301579952,
                0.004218084737658501,
                0.0031519923359155655,
                0.001585223013535142,
                0.002474172506481409,
                0.0022921375930309296,
                0.0010674927616491914,
                0.0017473205225542188,
                0.007049733307212591,
                0.0021480675786733627,
                0.0022386512719094753,
                0.004388985224068165,
                0.0072693536058068275,
                0.0026283569168299437,
                0.0010250895284116268,
                0.0010101301595568657,
                0.00327877514064312,
                0.0009920551674440503,
                2.0686078642029315e-05,
                0.004611819516867399,
                0.007256996352225542,
                0.00015992305998224765,
                0.00042634218698367476,
                7.674678636249155e-05,
                0.0009078052826225758,
                0.0035918881185352802,
                0.0036752503365278244,
                0.002641283208504319,
                0.007517131045460701,
                0.006208370439708233,
                0.0003235030162613839,
                0.0023689428344368935,
                0.000694339454639703,
                0.0032401233911514282,
                0.0006816266686655581,
                0.005149540491402149,
                0.00026554465875960886,
                0.0007748511270619929,
                0.001707789720967412,
                0.0,
                7.394339627353474e-05,
                0.000906477973330766,
                0.0024561486206948757,
                0.007200376130640507,
                0.00019824417540803552,
                0.00024871903588064015,
                0.005734178237617016,
                0.004993004724383354,
                0.0014226117637008429,
                0.003506061853840947,
                0.007565190549939871,
                0.0002543275186326355,
                0.0033882984425872564,
                0.0032119611278176308,
                0.005502156913280487,
                0.0038236756809055805,
                0.0005301295896060765,
                0.003710429882630706,
                0.0075355153530836105,
                0.003933940082788467,
                0.0036045147571712732,
                0.007590321823954582,
                0.00028050149558112025,
                0.001337182242423296,
                0.0037460308521986008,
                0.006966301705688238,
                0.0004151228931732476,
                0.0005907862796448171,
                0.0027920748107135296,
                0.0005245197098702192,
                0.007971602492034435,
                0.0005114288069307804,
                0.0003361055569257587,
                0.0034782574512064457,
                0.00017020413361024112,
                0.0015096381539478898,
                0.0007415501750074327,
                0.0009112665429711342,
                0.0003188286500517279,
                0.0005779103958047926,
                0.00038780600880272686,
                7.6098863246443216e-06,
                0.0,
                0.0004964676918461919,
                0.0033449698239564896,
                0.0017198651330545545,
                0.0004394316638354212,
                0.0004927273257635534,
                0.0012993295677006245,
                0.004179306793957949
            ]
        }
    }
    # excel信息
    excel_path = '历史净值数据_万得指数.xlsx'
    excel_sheet = '历史净值数据'
    # 字典转Json, 模拟输入的Json参数
    json_str = json.dumps(dict_input, ensure_ascii=False)
    print(json_str)

    ''' 1. 解析json参数 & 读取excel数据 --------------------------------------------------------------------------- '''
    (asset_list, draw_plt, draw_plt_filename, user_holding, ef_data,
     returns) = analysis_json_and_read_data(json_str, excel_path, excel_sheet)

    ''' 2. 读取数据，计算收益率矩阵 -------------------------------------------------------------------------------- '''
